---
- name: Gather facts from all hosts and process on localhost
  hosts: all
  gather_facts: yes
  tasks:
    - name: Set default local info fact (Data Center default to DC1)
      set_fact:
        local_info1: "DC1"

    - name: Write gathered facts into a centralized structured text file (Jinja2 to text)
      template:
        src: system_data_template.j2
        dest: /tmp/system_data_{{ inventory_hostname }}.txt
      delegate_to: localhost

    - name: Run Bash script to process structured data and generate CSV
      delegate_to: localhost
      shell: bash /tmp/process_system_data.sh /tmp/system_data_*.txt /tmp/final_report.csv

    - name: Display the CSV report location
      debug:
        msg: "The CSV report has been generated at /tmp/final_report.csv"
      delegate_to: localhost
