---
- name: Gather facts from all hosts and write to centralized text file
  hosts: all
  gather_facts: yes
  tasks:
    - name: Set default local info fact (Data Center default to DC1)
      set_fact:
        local_info1: "DC1"

    - name: Collect all gathered facts into a centralized text file (Jinja2 to text)
      template:
        src: centralized_system_data.j2
        dest: /tmp/centralized_system_data.txt
      delegate_to: localhost
      run_once: true

    - name: Run Bash script to process centralized data and generate CSV
      delegate_to: localhost
      shell: bash /tmp/process_centralized_data.sh /tmp/centralized_system_data.txt /tmp/final_report.csv

    - name: Display the CSV report location
      debug:
        msg: "The CSV report has been generated at /tmp/final_report.csv"
      delegate_to: localhost
